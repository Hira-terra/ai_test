# 実装計画書

**バージョン**: 1.0.0  
**最終更新日**: 2025-08-08  
**ステータス**: 設計完了  

## 1. 実装戦略概要

### 1.1 開発アプローチ

このプロジェクトでは、**アジャイル開発**と**段階的リリース**を組み合わせた実装戦略を採用します。

**核心的価値優先の段階的実装**：
1. **Phase 1**: 認証・基盤機能（必須基盤）
2. **Phase 2**: 顧客管理コア機能（最優先価値）
3. **Phase 3**: 受注・売上計上機能（核心価値）
4. **Phase 4**: 在庫・レジ精算機能（運営必須）
5. **Phase 5**: 分析・管理機能（付加価値）

### 1.2 技術的実装順序の根拠

| 機能 | 実装優先度 | 理由 | 依存関係 |
|------|----------|------|----------|
| **認証システム** | 最高 | 全機能の前提条件 | なし |
| **顧客検索・詳細** | 最高 | 現場スタッフの日常業務の核心 | 認証システム |
| **受注入力** | 最高 | 売上計上タイミングの改善（プロジェクトの核心価値） | 顧客管理 |
| **レジ精算** | 高 | 日次必須業務 | 受注システム |
| **在庫管理** | 高 | 商品管理の基盤 | 商品マスタ |
| **分析機能** | 中 | 経営判断支援（データ蓄積後に効果的） | 全データ蓄積 |

## 2. 開発フェーズ詳細計画

### Phase 1: 認証・基盤システム実装（2週間）

#### 2.1.1 バックエンド基盤構築
**期間**: 1週間  
**担当**: Phase 8 バックエンド実装エージェント

**実装タスク**:
- [ ] **1.1.1** PostgreSQL データベース環境構築
  - スキーマ作成（全14テーブル）
  - インデックス設定
  - RLS（行レベルセキュリティ）設定
- [ ] **1.1.2** Node.js + Express アプリケーション基盤
  - プロジェクト構造作成
  - 環境変数管理
  - ログ設定
- [ ] **1.1.3** 認証システム実装
  - JWT トークン生成・検証
  - パスワード暗号化（bcrypt）
  - セッション管理
- [ ] **1.1.4** セキュリティミドルウェア
  - 認証ミドルウェア実装
  - 権限チェック機能
  - レート制限
- [ ] **1.1.5** 監査ログシステム
  - 操作ログ記録
  - セキュリティイベント記録

**成果物**:
- 完全に動作する認証API
- データベース環境
- セキュリティ基盤

**検証基準**:
- ログイン・ログアウトが正常動作
- 権限別アクセス制御が機能
- セキュリティテスト通過

#### 2.1.2 フロントエンド基盤構築  
**期間**: 1週間  
**担当**: Phase 7 プロトタイプ実装エージェント

**実装タスク**:
- [ ] **1.2.1** React アプリケーション構築
  - Create React App セットアップ
  - TypeScript 設定
  - 型定義ファイル作成（frontend/src/types/index.ts）
- [ ] **1.2.2** Material-UI テーマ設定
  - 眼鏡店ブランドに適した配色
  - レスポンシブデザイン対応
  - タブレット最適化
- [ ] **1.2.3** ルーティング設定
  - React Router 実装
  - 権限別ルート制御
  - 認証ガード
- [ ] **1.2.4** 認証UI実装
  - ログインページ（P-001）
  - 認証状態管理（Context API）
  - JWT トークン管理
- [ ] **1.2.5** 共通コンポーネント
  - ヘッダー・ナビゲーション
  - エラー表示
  - ローディング表示

**成果物**:
- 認証機能付きReactアプリケーション
- 共通UI コンポーネント
- ルーティング設定

**検証基準**:
- ログインフローが完全動作
- 権限別ページアクセスが機能
- タブレット表示が適切

### Phase 2: 顧客管理システム実装（3週間）

#### 2.2.1 顧客データAPI開発
**期間**: 1週間

**実装タスク**:
- [ ] **2.1.1** 顧客CRUD API実装
  - GET /api/customers （検索・一覧）
  - GET /api/customers/:id （詳細取得）
  - PUT /api/customers/:id （更新）
  - POST /api/customers （新規作成）
- [ ] **2.1.2** 処方箋API実装
  - GET /api/customers/:id/prescriptions
  - POST /api/customers/:id/prescriptions
  - PUT /api/prescriptions/:id
- [ ] **2.1.3** 顧客画像API実装
  - POST /api/customers/:id/images （アップロード）
  - GET /api/customers/:id/images （一覧取得）
  - DELETE /api/customers/:id/images/:imageId
- [ ] **2.1.4** 画像注釈API実装
  - GET /api/customers/:id/images/:imageId/annotations
  - PUT /api/customers/:id/images/:imageId/annotations
- [ ] **2.1.5** 顧客メモAPI実装
  - GET /api/customers/:id/memos
  - POST /api/customers/:id/memos
  - PUT /api/customers/:id/memos/:memoId

#### 2.2.2 顧客検索ページ実装
**期間**: 1週間

**実装タスク**:
- [ ] **2.2.1** 顧客検索UI（S-001）
  - 検索フォーム（名前、カナ、電話番号）
  - 検索結果一覧表示
  - ページネーション
- [ ] **2.2.2** 検索機能最適化
  - リアルタイム検索
  - 検索履歴管理
  - 高速レスポンス（3秒以内）
- [ ] **2.2.3** 新規顧客登録
  - 顧客登録フォーム
  - バリデーション機能
  - 重複チェック

#### 2.2.3 顧客詳細ページ実装
**期間**: 1週間

**実装タスク**:
- [ ] **2.3.1** 基本情報タブ
  - 顧客基本情報表示・編集
  - フォームバリデーション
  - 来店履歴表示
- [ ] **2.3.2** 処方箋タブ
  - 度数データ表示（時系列）
  - 新規処方箋登録
  - 処方箋編集機能
- [ ] **2.3.3** 購入履歴タブ
  - 過去の受注一覧
  - 詳細な商品情報表示
  - 金額情報表示
- [ ] **2.3.4** メモ・画像タブ
  - 画像アップロード機能
  - Fabric.js 画像注釈機能
  - メモ入力・編集
  - レイヤー別データ保存

**Phase 2 成果物**:
- 顧客管理の完全機能
- 画像注釈システム
- 検索・詳細表示機能

**検証基準**:
- 顧客検索が3秒以内に応答
- 画像注釈機能が正常動作
- タブレット操作性が良好

### Phase 3: 受注・売上計上システム実装（3週間）

#### 2.3.1 商品・在庫基盤API
**期間**: 1週間

**実装タスク**:
- [ ] **3.1.1** 商品マスタAPI
  - GET /api/products （商品一覧）
  - GET /api/products/:id （商品詳細）
  - 原価情報の権限制御
- [ ] **3.1.2** フレーム在庫API
  - GET /api/inventory/frames （フレーム一覧）
  - GET /api/inventory/frames/:serialNumber （個品情報）
  - PUT /api/inventory/frames/:serialNumber/status （状態更新）
- [ ] **3.1.3** 在庫数量API
  - GET /api/inventory/products （数量管理商品）
  - PUT /api/inventory/products/:id/stock （在庫更新）

#### 2.3.2 受注システムAPI
**期間**: 1週間

**実装タスク**:
- [ ] **3.2.1** 受注CRUD API
  - POST /api/orders （新規受注）
  - GET /api/orders （受注一覧）
  - GET /api/orders/:id （受注詳細）
  - PUT /api/orders/:id （受注更新）
- [ ] **3.2.2** 売上計上機能
  - 受注確定時の自動売上計上
  - 売掛金管理
  - 在庫自動減算
- [ ] **3.2.3** 入金管理API
  - POST /api/orders/:id/payments （入金記録）
  - GET /api/orders/:id/payments （入金履歴）

#### 2.3.3 受注UI実装
**期間**: 1週間

**実装タスク**:
- [ ] **3.3.1** 受注入力ページ（S-003）
  - 顧客選択・検索
  - 商品選択（フレーム・レンズ）
  - 処方箋連携
  - 金額自動計算
- [ ] **3.3.2** 決済・入金処理
  - 支払方法選択
  - 一部入金対応
  - 売掛金管理
- [ ] **3.3.3** 受注一覧ページ（S-004）
  - 受注状況確認
  - 納期管理
  - ステータス更新

**Phase 3 成果物**:
- 受注時売上計上システム
- 在庫連動機能
- 売掛金管理

**検証基準**:
- 受注確定時に売上が正確に計上される
- 在庫が正確に減算される
- 売掛金管理が正常に機能する

### Phase 4: 在庫・レジ精算システム実装（2週間）

#### 2.4.1 在庫管理完成
**期間**: 1週間

**実装タスク**:
- [ ] **4.1.1** 在庫管理ページ（S-005）
  - フレーム個品管理画面
  - 数量管理画面
  - 在庫検索機能
- [ ] **4.1.2** 在庫移動・調整
  - 店舗間移動機能
  - 棚卸し機能
  - 在庫調整機能

#### 2.4.2 レジ精算システム
**期間**: 1週間

**実装タスク**:
- [ ] **4.2.1** レジ精算API完成
  - POST /api/cash-register/open （レジ開設）
  - GET /api/cash-register/status （レジ状態）
  - POST /api/cash-register/close （レジ精算）
  - GET /api/cash-register/sales-summary （売上集計）
- [ ] **4.2.2** レジ精算UI完成
  - レジ開設処理画面
  - 売上集計表示
  - 現金実査入力
  - 精算レポート出力

**Phase 4 成果物**:
- 完全な在庫管理システム
- 日次レジ精算機能
- 金銭管理システム

### Phase 5: 分析・管理機能実装（2週間）

#### 2.5.1 ダッシュボード・分析機能
**期間**: 2週間

**実装タスク**:
- [ ] **5.1.1** 店舗ダッシュボード（M-001）
  - 売上分析表示
  - 顧客分析機能
  - レポート出力
- [ ] **5.1.2** 本部ダッシュボード（H-001）
  - 全店舗売上統計
  - 店舗比較機能
  - 原価分析
- [ ] **5.1.3** ユーザー管理（H-002）
  - スタッフ管理画面
  - 権限設定
  - パスワード管理

**Phase 5 成果物**:
- 分析・レポート機能
- 管理機能一式

## 3. 技術的リスクと対策

### 3.1 高優先度リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| **画像注釈機能の複雑性** | 高 | 中 | Fabric.js の事前検証、シンプルな実装から開始 |
| **大量データ処理性能** | 高 | 中 | データベースインデックス最適化、ページング実装 |
| **タブレット最適化** | 高 | 低 | 早期段階でのタブレットテスト、レスポンシブ設計 |
| **店舗間データ同期** | 中 | 中 | リアルタイム通信の実装、障害時の復旧機能 |

### 3.2 リスク軽減策

#### 3.2.1 画像注釈機能
- **対策**: Phase 2で早期に基本機能を実装し、段階的に機能拡張
- **代替案**: 画像注釈が困難な場合は、まず基本的な画像表示から開始

#### 3.2.2 パフォーマンス最適化
- **対策**: 各Phaseでパフォーマンステストを実施
- **指標**: 顧客検索3秒以内、画面遷移2秒以内

#### 3.2.3 タブレット対応
- **対策**: Phase 1からタブレット実機でのテストを継続実施
- **指標**: iPad/Android タブレットでの操作性検証

## 4. テスト戦略とQA計画

### 4.1 テスト段階

#### 4.1.1 単体テスト
**実施時期**: 各Phase の開発中  
**対象**: 
- API エンドポイント全て
- React コンポーネント
- ビジネスロジック関数

**テスト項目**:
- 正常系処理の検証
- 異常系・境界値テスト
- セキュリティテスト

#### 4.1.2 統合テスト
**実施時期**: 各Phase 完了時  
**対象**:
- フロントエンド・バックエンド連携
- データベース連携
- 外部システム連携

#### 4.1.3 システムテスト
**実施時期**: Phase 3, 4 完了時  
**対象**:
- エンドツーエンドシナリオ
- パフォーマンステスト
- セキュリティテスト

#### 4.1.4 ユーザビリティテスト
**実施時期**: Phase 2, 4 完了時  
**対象**:
- 実店舗スタッフによる操作性検証
- タブレット操作性テスト
- 業務フロー検証

### 4.2 品質基準

| 項目 | 基準値 | 測定方法 |
|------|--------|----------|
| **レスポンスタイム** | 顧客検索: 3秒以内 | 自動テスト |
| **可用性** | 99.5% 以上 | 監視システム |
| **セキュリティ** | 脆弱性検出: 0件 | セキュリティスキャン |
| **ユーザビリティ** | タブレット操作成功率: 95%以上 | ユーザビリティテスト |

## 5. デプロイ・展開計画

### 5.1 段階的展開戦略

#### 5.1.1 Phase A: パイロット店舗（1店舗）
- **期間**: Phase 4 完了後 1週間
- **目的**: 実運用での動作検証
- **店舗**: 最も協力的な店舗1つを選定

#### 5.1.2 Phase B: 拡大展開（5店舗）
- **期間**: パイロット完了後 1週間
- **目的**: 負荷テストと課題発見
- **店舗**: 異なる特性の店舗5つ

#### 5.1.3 Phase C: 全店舗展開（40店舗）
- **期間**: 拡大展開完了後 2週間
- **目的**: 全店舗での本格運用開始
- **サポート**: 24時間対応体制

### 5.2 展開時の対応体制

#### 5.2.1 サポート体制
- **開発チーム**: 緊急時の修正対応
- **運用チーム**: ユーザーサポート・問い合わせ対応
- **研修チーム**: スタッフトレーニング

#### 5.2.2 監視・メンテナンス
- **システム監視**: 24時間自動監視
- **定期メンテナンス**: 週次・月次点検
- **バックアップ**: 日次自動バックアップ

## 6. 開発リソースと期間

### 6.1 全体スケジュール

```
Phase 1: 認証・基盤        [2週間] ████████
Phase 2: 顧客管理         [3週間] ████████████
Phase 3: 受注・売上       [3週間] ████████████  
Phase 4: 在庫・レジ       [2週間] ████████
Phase 5: 分析・管理       [2週間] ████████
展開準備・テスト         [2週間] ████████
═══════════════════════════════════════════
総開発期間: 14週間（約3.5ヶ月）
```

### 6.2 必要リソース

#### 6.2.1 技術スタック
**フロントエンド**:
- React 18 + TypeScript
- Material-UI v5
- Fabric.js（画像注釈）
- React Router v6

**バックエンド**:
- Node.js + Express
- PostgreSQL 15
- JWT認証
- bcrypt（パスワード暗号化）
- Multer（ファイルアップロード）

**インフラ**:
- Docker（開発・本番環境）
- Nginx（リバースプロキシ）
- SSL/TLS証明書

#### 6.2.2 開発環境要件
- Node.js v18以上
- PostgreSQL 15
- Redis（セッション管理）
- Git版本管理

## 7. 成功指標（KPI）

### 7.1 技術的KPI

| 指標 | 目標値 | 測定時期 |
|------|--------|----------|
| **システム応答時間** | 平均2秒以内 | 各Phase完了時 |
| **可用性** | 99.5%以上 | 運用開始後 |
| **バグ検出率** | 重要バグ0件 | リリース前 |
| **セキュリティ脆弱性** | 0件 | リリース前 |

### 7.2 事業的KPI

| 指標 | 目標値 | 測定時期 |
|------|--------|----------|
| **ユーザー採用率** | 95%以上 | 展開完了後1ヶ月 |
| **業務効率化** | 顧客検索時間50%短縮 | 運用1ヶ月後 |
| **データ精度向上** | 売上計上精度99%以上 | 運用1ヶ月後 |
| **顧客満足度** | アンケート4.5点以上 | 運用3ヶ月後 |

## 8. 実装計画の変更管理

### 8.1 変更プロセス
1. **変更要求**: ユーザーフィードバック・技術的課題
2. **影響分析**: スケジュール・リソース・品質への影響評価
3. **優先度評価**: 必須・推奨・将来対応の分類
4. **承認プロセス**: 関係者レビューと承認
5. **計画更新**: スケジュール・リソース計画の更新

### 8.2 定期レビュー
- **週次**: 進捗確認・課題共有
- **Phase完了時**: 成果物レビュー・次Phase計画調整
- **月次**: 全体計画見直し

この実装計画に従って、段階的かつ確実にシステムを構築し、眼鏡店の業務革新を実現します。
# 個体管理機能 完全テストシナリオ

## 🎯 テスト目的
入庫管理から個体管理までの正しい業務フローが動作することを確認

## 📋 前提条件
- ✅ Docker環境が起動している
- ✅ テスト用発注データが投入済み
- ✅ 認証情報: manager001 / password / STORE001

## 🔄 テストフロー

### Step 1: システムログイン
1. ブラウザで http://localhost:3000 にアクセス
2. 以下の認証情報でログイン
   - ユーザーコード: `manager001`
   - パスワード: `password`
   - 店舗コード: `STORE001`

### Step 2: 発注履歴の確認
1. サイドバーから「発注履歴」をクリック
2. 以下の発注データが表示されることを確認
   - **PO-20250909-001**: フレーム商品（FRAME001）x3個 - 個体管理対象 ✨
   - **PO-20250909-002**: レンズ商品（LENS001）x5個 - 数量管理

### Step 3: 入庫管理画面へ移動
1. サイドバーから「入庫管理」をクリック
2. 「発注済み商品の入庫」セクションを確認
3. 以下の発注が入庫待ちで表示されることを確認
   - PO-20250909-001（送信済み）
   - PO-20250909-002（確認済み）

### Step 4: フレーム商品の入庫処理（個体番号付番）
1. **PO-20250909-001（フレーム商品）**の行で「入庫」ボタンをクリック
2. 入庫詳細ダイアログが開く
3. **FRAME001**の行で以下を入力：
   - 入庫数量: `3`
   - 品質: `良好`
   - メモ: `テスト入庫`
4. **🔑 重要**: 「個体番号割当」ボタンをクリック
5. 個体番号割り当てダイアログが開く
6. 3つの個体が以下の形式で自動生成されることを確認：
   - `FRAME001-ST01-20250909-001`
   - `FRAME001-ST01-20250909-002`
   - `FRAME001-ST01-20250909-003`
7. 各個体の詳細を設定：
   - 色: `ブラック`、`ブラウン`、`シルバー`
   - サイズ: `M`
   - ステータス: `在庫中`
   - 保管場所: `メイン倉庫`
8. 「3個の個体を登録」ボタンをクリック
9. 成功メッセージを確認

### Step 5: レンズ商品の入庫処理（数量管理）
1. **PO-20250909-002（レンズ商品）**の行で「入庫」ボタンをクリック
2. **LENS001**の行で以下を入力：
   - 入庫数量: `5`
   - 品質: `良好`
3. 個体番号割り当ては**不要**（数量管理のため）
4. 「入庫完了」ボタンをクリック

### Step 6: 個体管理画面での確認
1. サイドバーから「個体管理」をクリック
2. 以下を確認：
   - ✅ 在庫サマリー: 在庫中が**3個**表示
   - ✅ 個体一覧テーブルに3つのフレーム個体が表示
   - ✅ 個体番号が商品コード付きで表示
   - ✅ 「新規個体登録」ボタンが**存在しない**こと

### Step 7: 個体検索・フィルタ機能テスト
1. 個体番号検索で `FRAME001` と入力 → 3件表示
2. 個体番号検索で `001` と入力 → 1件表示
3. ステータス フィルタで「在庫中」選択 → 3件表示
4. 商品フィルタで「クラシックフレーム A型」選択 → 3件表示
5. 「クリア」ボタンで全フィルタ解除

### Step 8: 個体情報の更新テスト
1. 任意の個体の「編集」ボタンをクリック
2. 個体情報編集ダイアログが開く
3. 以下を変更：
   - 色: `レッド`
   - ステータス: `予約済み`
   - 保管場所: `展示エリア`
4. 「更新」ボタンをクリック
5. 個体一覧で変更が反映されることを確認
6. 在庫サマリーで「在庫中2個」「予約済み1個」に変更されることを確認

## ✅ 期待される結果

### 正常動作の確認項目
- [ ] ログインが成功する
- [ ] 発注履歴に2件の発注データが表示される
- [ ] 入庫管理で発注済み商品が確認できる
- [ ] フレーム商品に個体番号が正しく付番される
- [ ] 個体番号の形式が `{商品コード}-{店舗コード}-{日付}-{連番}` である
- [ ] 個体管理画面で付番された個体が表示される
- [ ] 個体検索・フィルタ機能が動作する
- [ ] 個体情報の更新ができる
- [ ] 在庫サマリーが正確に表示される

### 業務フロー確認項目
- [ ] 入庫時に個体番号が自動付番される
- [ ] 個体管理画面で新規登録ができない（正しい制限）
- [ ] 商品コードと個体番号が完全に紐付いている
- [ ] 個体管理対象商品と数量管理商品が区別される

## 🚨 想定されるエラーと対処

### ログインエラー
- **エラー**: 認証失敗
- **対処**: Docker環境が起動していることを確認

### 発注データが表示されない
- **エラー**: 空のリスト
- **対処**: テスト用SQLスクリプトを再実行

### 個体番号付番エラー
- **エラー**: 500エラー
- **対処**: framesテーブルが存在することを確認

## 📞 成功時の最終確認

個体管理画面で以下が表示されれば成功：
```
在庫サマリー: 在庫中 3個

個体一覧:
FRAME001-ST01-20250909-001 | クラシックフレーム A型 | ブラック/M | 在庫中
FRAME001-ST01-20250909-002 | クラシックフレーム A型 | ブラウン/M | 在庫中  
FRAME001-ST01-20250909-003 | クラシックフレーム A型 | シルバー/M | 在庫中
```

## 🔄 テスト完了後のクリーンアップ

テストを繰り返したい場合：
```bash
cd /home/h-hiramitsu/projects/test_kokyaku
docker exec -i glasses_postgres psql -U glasses_user -d glasses_store_db < setup_individual_management_test.sql
```